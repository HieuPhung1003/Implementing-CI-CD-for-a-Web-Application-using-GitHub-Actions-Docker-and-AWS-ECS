{{> header}}

{{#if user}}
<!-- Dashboard for logged-in users -->
<div class="container">
  <div class="dashboard-header">
    <h1 class="dashboard-title">B·∫£ng ƒëi·ªÅu khi·ªÉn kho h√†ng</h1>
    <p class="dashboard-subtitle">Xin ch√†o, <strong>{{user.username}}</strong>! ƒê√¢y l√† th·ªëng k√™ t·ªïng h·ª£p h√¥m nay.</p>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon" style="background: linear-gradient(135deg, #6366f1, #8b5cf6);">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </svg>
      </div>
      <div class="stat-content">
        <h3 class="stat-label">T·ªïng s·∫£n ph·∫©m</h3>
        <p class="stat-value">{{stats.totalProducts}}</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #059669);">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="1" x2="12" y2="23"></line>
          <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </svg>
      </div>
      <div class="stat-content">
        <h3 class="stat-label">Gi√° tr·ªã kho h√†ng</h3>
        <p class="stat-value">{{stats.totalValue}} ƒë</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </svg>
      </div>
      <div class="stat-content">
        <h3 class="stat-label">S·∫Øp h·∫øt h√†ng</h3>
        <p class="stat-value alert">{{stats.lowStockCount}}</p>
      </div>
    </div>
  </div>
</div>



  <!-- Inventory Chart -->
  <div class="container">
    <div class="chart-container" data-inventory='{{{productChartJSON}}}'>
      <h3 class="chart-title">S·ªë l∆∞·ª£ng t·ªìn kho theo danh m·ª•c</h3>
      <div style="position: relative; height: 400px;">
        <canvas id="productInventoryChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Quick Links -->
  <div class="container">
    <div class="quick-links-section">
      <h3 class="section-title">C√°c t√°c v·ª• nhanh</h3>
      <div class="quick-links">
        <a href="/inventory" class="quick-link-card">
          <span class="quick-link-icon">üì¶</span>
          <span class="quick-link-text">Xem kho h√†ng</span>
        </a>
        <a href="/inventory/add" class="quick-link-card">
          <span class="quick-link-icon">‚ûï</span>
          <span class="quick-link-text">Nh·∫≠p h√†ng m·ªõi</span>
        </a>
        <a href="/history" class="quick-link-card">
          <span class="quick-link-icon">üìã</span>
          <span class="quick-link-text">Xem l·ªãch s·ª≠</span>
        </a>
        <a href="/inventory/export" class="quick-link-card" target="_blank">
          <span class="quick-link-icon">‚¨áÔ∏è</span>
          <span class="quick-link-text">Xu·∫•t d·ªØ li·ªáu</span>
        </a>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const ctx = document.getElementById('productInventoryChart');
      if (!ctx) return;
      
      try {
        const dataStr = document.querySelector('[data-inventory]').dataset.inventory;
        const productChart = JSON.parse(dataStr);

        new Chart(ctx.getContext('2d'), {
          type: 'bar',
          data: {
            labels: Object.keys(productChart),
            datasets: [{
              label: 'S·ªë l∆∞·ª£ng t·ªìn kho',
              data: Object.values(productChart),
              backgroundColor: [
                'rgba(99, 102, 241, 0.6)',
                'rgba(236, 72, 153, 0.6)',
                'rgba(16, 185, 129, 0.6)',
                'rgba(59, 130, 246, 0.6)',
                'rgba(245, 158, 11, 0.6)'
              ],
              borderColor: [
                'rgba(99, 102, 241, 1)',
                'rgba(236, 72, 153, 1)',
                'rgba(16, 185, 129, 1)',
                'rgba(59, 130, 246, 1)',
                'rgba(245, 158, 11, 1)'
              ],
              borderWidth: 2,
              borderRadius: 8
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { 
                display: true,
                labels: { color: '#94a3b8' }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                ticks: { color: '#9ca3af' }
              },
              x: {
                grid: { display: false },
                ticks: { color: '#9ca3af' }
              }
            }
          }
        });
      } catch(error) {
        console.error('Error loading chart:', error);
      }
    });
  </script>

{{else}}
<!-- Hero Section for Guests -->
<div class="hero-section">
  <div class="container">
    <div class="hero-content">
      <h1 class="hero-title">Qu·∫£n L√Ω Kho H√†ng Th√¥ng Minh</h1>
      <p class="hero-description">H·ªá th·ªëng qu·∫£n l√Ω kho h√†ng hi·ªáu qu·∫£ v·ªõi giao di·ªán th√¢n thi·ªán, theo d√µi t·ªìn kho theo th·ªùi gian th·ª±c.</p>
      
      <div class="hero-buttons">
        <a href="/login" class="btn btn-primary btn-large">
          <span>üîê ƒêƒÉng Nh·∫≠p</span>
        </a>
        <a href="/register" class="btn btn-secondary btn-large">
          <span>‚úçÔ∏è ƒêƒÉng K√Ω</span>
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Features Section -->
<div class="container">
  <div class="features-section">
    <h2 class="section-title">T√≠nh nƒÉng n·ªïi b·∫≠t</h2>
    <div class="features-grid">
      <div class="feature-card">
        <div class="feature-icon" style="background: linear-gradient(135deg, #6366f1, #8b5cf6);">
          üìä
        </div>
        <h3>Th·ªëng k√™ chi ti·∫øt</h3>
        <p>Xem t·ªïng quan t·ªìn kho, gi√° tr·ªã h√†ng h√≥a v√† c√°c c·∫£nh b√°o s·∫Øp h·∫øt h√†ng</p>
      </div>

      <div class="feature-card">
        <div class="feature-icon" style="background: linear-gradient(135deg, #10b981, #059669);">
          üéØ
        </div>
        <h3>Qu·∫£n l√Ω nhanh</h3>
        <p>Th√™m, s·ª≠a, x√≥a s·∫£n ph·∫©m v·ªõi giao di·ªán ƒë∆°n gi·∫£n v√† tr·ª±c quan</p>
      </div>

      <div class="feature-card">
        <div class="feature-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
          üìù
        </div>
        <h3>L·ªãch s·ª≠ giao d·ªãch</h3>
        <p>Theo d√µi to√†n b·ªô l·ªãch s·ª≠ nh·∫≠p/xu·∫•t h√†ng v·ªõi ghi ch√∫ chi ti·∫øt</p>
      </div>

      <div class="feature-card">
        <div class="feature-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
          üë•
        </div>
        <h3>ƒêa ng∆∞·ªùi d√πng</h3>
        <p>M·ªói ng∆∞·ªùi d√πng c√≥ kho h√†ng ri√™ng v·ªõi d·ªØ li·ªáu ho√†n to√†n ƒë·ªôc l·∫≠p</p>
      </div>

      <div class="feature-card">
        <div class="feature-icon" style="background: linear-gradient(135deg, #06b6d4, #0891b2);">
          üì•
        </div>
        <h3>Xu·∫•t d·ªØ li·ªáu</h3>
        <p>Xu·∫•t to√†n b·ªô danh s√°ch h√†ng h√≥a ra file CSV ƒë·ªÉ s·ª≠ d·ª•ng ngo√†i</p>
      </div>

      <div class="feature-card">
        <div class="feature-icon" style="background: linear-gradient(135deg, #8b5cf6, #6366f1);">
          üîí
        </div>
        <h3>B·∫£o m·∫≠t</h3>
        <p>M·∫≠t kh·∫©u ƒë∆∞·ª£c m√£ h√≥a b·∫±ng bcryptjs, phi√™n ƒëƒÉng nh·∫≠p an to√†n</p>
      </div>
    </div>
  </div>
</div>

<!-- CTA Section -->
<div class="container">
  <div class="cta-section">
    <div class="cta-content">
      <h2>S·∫µn s√†ng b·∫Øt ƒë·∫ßu?</h2>
      <p>T·∫°o t√†i kho·∫£n mi·ªÖn ph√≠ ngay h√¥m nay v√† qu·∫£n l√Ω kho h√†ng c·ªßa b·∫°n</p>
      <a href="/register" class="btn btn-primary btn-large">ƒêƒÉng K√Ω Ngay</a>
    </div>
  </div>
</div>

{{/if}}

{{> footer}}